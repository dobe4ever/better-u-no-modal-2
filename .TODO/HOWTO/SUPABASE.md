This is the workflow to follow whenever you want to **Create, Edit (Alter)**, or **Delete** tables or columns in the future.

### 1. **Create a New Migration File:**
- Decide on a descriptive name for your change (use underscores, lowercase).
- Examples: `create_todos_table`, `add_priority_to_todos`, `remove_old_user_settings_table`.

- Run the `migration new` command:
```Bash
npx supabase migration new <your_descriptive_name>
```

- **Example:** To create a 'todos' table:
```Bash
npx supabase migration new create_todos_table
```

- This creates a new SQL file inside your Codespace at the path:
```
supabase/migrations/<timestamp>_<your_descriptive_name>.sql
```
- e.g.:
```
supabase/migrations/20231027123456_create_todos_table.sql)
```

### 2. **Edit the SQL Migration File:**

- Open the newly created SQL file (located at `supabase/migrations/<timestamp>_<your_descriptive_name>.sql`).

- Write the raw SQL commands for your desired change.

- **Example 1: Create `todos` table (edit `..._create_todos_table.sql`)**

```SQL
-- Create the table
CREATE TABLE todos (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id uuid REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
    task text CHECK (char_length(task) > 3),
    is_complete boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- Add Row Level Security (IMPORTANT!)
ALTER TABLE todos ENABLE ROW LEVEL SECURITY;

-- Add Policies (Define who can do what)
CREATE POLICY "Users can view their own todos" ON todos
    FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own todos" ON todos
    FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own todos" ON todos
    FOR UPDATE USING (auth.uid() = user_id) WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can delete their own todos" ON todos
    FOR DELETE USING (auth.uid() = user_id);
```

- **Example 2: Add a `priority` column to `todos` (edit `..._add_priority_to_todos.sql`)**

```SQL
ALTER TABLE todos
ADD COLUMN priority int CHECK (priority >= 1 AND priority <= 5) DEFAULT 3;
```

- **Example 3: Delete the `todos` table (edit `..._remove_todos_table.sql`)**

```SQL
DROP TABLE todos;
```

- Save the SQL file after editing.

### 3. **Apply the Migration to Your Remote Supabase Database:**

- This command checks for any new migration files in your `supabase/migrations` folder that haven't been applied to your linked remote database yet, and runs them.

```Bash
npx supabase db push
```
- Wait for the command to complete. It will show output indicating if the migration was successful. If there are SQL errors in your file, it will report them here. Fix the errors in the SQL file and run `npx supabase db push` again.

### 4. **Commit Your Migration File:**
- Crucially, add and commit the new SQL migration file to your Git repository. This keeps a history of your schema changes.

```Bash
git add supabase/migrations/<timestamp>_<your_descriptive_name>.sql
git commit -m "feat: add todos table schema" # Or a descriptive message for your change
git push # Push your code changes and the new migration file
```

**Summary for Future Use:**

Whenever you need to change your database schema (add table, add column, delete table, etc.):

1. Run `npx supabase migration new <change_description>`.
2. Edit the newly created SQL file under `supabase/migrations/`.
3. Run `npx supabase db push` to apply the changes to your live Supabase database.
4. Commit the new migration SQL file to Git (`git add supabase/migrations/..., git commit ..., git push`).

This workflow keeps your schema changes version-controlled alongside your code and applies them directly to the database linked to your Vercel deployment, all from your Codespace terminal